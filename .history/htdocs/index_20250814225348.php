!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>allergenfreedog ‚Äî Compare Dog Foods</title>
  <meta name="description" content="Compare dog foods by ingredients. Spot allergens like gluten or poultry. Built by allergenfreedog." />
  <style>
    :root{
      --bg:#fbf6ef;           /* soft beige */
      --ink:#274642;          /* dark green-ink */
      --muted:#5a7d75;        
      --primary:#79C99E;      /* soft green */
      --accent:#FF9F68;       /* warm orange */
      --card:#ffffff;         /* cards */
      --ok:#85d1a0;
      --warn:#ffd27a;
      --danger:#ffb0a3;
      --ring: 0 0 0 3px rgb(121 201 158 / .35);
      --shadow: 0 10px 24px rgba(0,0,0,.08);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}
    a{color:inherit}
    .container{max-width:1100px;margin-inline:auto;padding:24px}
    header{position:sticky;top:0;background:var(--bg)/.8;backdrop-filter:blur(8px);border-bottom:1px solid #e9e1d7;z-index:5}
    .nav{display:flex;align-items:center;gap:16px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px;font-weight:800;font-size:1.25rem;color:var(--ink)}
    .brand svg{width:28px;height:28px}
    .nav .actions{display:flex;gap:8px}
    .btn{appearance:none;border:0;border-radius:999px;padding:10px 16px;font-weight:700;cursor:pointer;transition:.2s;display:inline-flex;gap:8px;align-items:center}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:2px solid #c6dacd;color:var(--muted)}
    .btn.primary:hover{transform:translateY(-1px);filter:saturate(1.1)}
    .btn.ghost:hover{border-color:var(--primary);color:var(--ink)}

    .hero{padding:40px 0}
    .hero h1{font-size:clamp(1.6rem,1.2rem + 2vw,2.4rem);margin:0 0 8px;font-weight:900}
    .tag{color:var(--accent);font-weight:800}
    .lede{color:var(--muted);max-width:60ch}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:24px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .card h2{margin:0 0 12px;font-size:1.2rem}

    .field{display:grid;gap:8px;margin:10px 0}
    label{font-weight:700}
    input[type=text], textarea, select{width:100%;padding:12px 14px;border:2px solid #e3e8e4;border-radius:12px;background:white;color:var(--ink);outline:none}
    input:focus, textarea:focus, select:focus{border-color:var(--primary);box-shadow:var(--ring)}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:680px){.row{grid-template-columns:1fr}}

    table{width:100%;border-collapse:collapse}
    th,td{padding:12px 10px;border-bottom:1px solid #eee;vertical-align:top}
    th{background:#f8faf7;text-align:left;position:sticky;top:0;z-index:2}
    tr.hover:hover{background:#faf9f6}
    .pill{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:4px 10px;font-size:.8rem;font-weight:700}
    .pill.ok{background:var(--ok)}
    .pill.warn{background:var(--warn)}
    .pill.danger{background:var(--danger)}
    .taglink{color:var(--muted);text-decoration:underline dotted}

    .filters{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 12px}
    .chip{border:2px solid #c6dacd;border-radius:999px;padding:6px 10px;font-weight:700;color:var(--muted);cursor:pointer}
    .chip.active{background:var(--primary);border-color:var(--primary);color:#fff}

    footer{margin-top:40px;border-top:1px solid #e9e1d7}
    footer .inner{display:flex;flex-wrap:wrap;gap:12px;justify-content:space-between;align-items:center;padding:18px 0;color:var(--muted)}

    /* Modal */
    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.35);padding:24px;z-index:10}
    .modal.open{display:grid}
    .modal .sheet{max-width:900px;width:100%;background:var(--card);border-radius:20px;box-shadow:var(--shadow)}
    .sheet .head{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid #eef2ef}
    .sheet h3{margin:0}
    .sheet .body{padding:12px 18px 22px}
    .glossary{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .gloss{border:1px solid #edf0ee;border-radius:14px;padding:10px}
    .gloss h4{margin:0 0 6px}
    .muted{color:var(--muted)}
    .sr{position:absolute;left:-10000px}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand" aria-label="allergenfreedog brand">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M20 20c0-4 3-7 7-7s7 3 7 7-3 7-7 7-7-3-7-7Z" fill="#79C99E"/><circle cx="48" cy="20" r="6" fill="#79C99E"/><circle cx="17" cy="36" r="5" fill="#79C99E"/><circle cx="35" cy="43" r="5" fill="#79C99E"/><path d="M20 53c6 5 18 5 24 0 5-4 6-11 2-16-6-7-22-7-28 0-4 5-3 12 2 16Z" fill="#FF9F68"/></svg>
        allergenfreedog
      </div>
      <div class="actions">
        <button class="btn ghost" id="openGlossary">Ingredient Glossary</button>
        <a class="btn primary" href="#compare">Compare Now</a>
      </div>
    </div>
  </header>

  <main class="container hero">
    <div class="grid">
      <section class="card">
        <h1><span class="tag">Compare dog foods</span> and spot allergens instantly üêæ</h1>
        <p class="lede">Paste labels or pick built‚Äëins. We normalise ingredients and highlight <strong>gluten</strong>, <strong>poultry</strong>, common <strong>allergens</strong>, and <strong>overlaps</strong>. Fully client‚Äëside ‚Äî just upload this file to your InfinityFree hosting.</p>

        <form id="compare" class="form" aria-labelledby="compareHeading">
          <h2 id="compareHeading">Compare Dog Foods</h2>
          <div class="filters" role="group" aria-label="Filters">
            <button type="button" class="chip active" data-filter="showAll">Show all</button>
            <button type="button" class="chip" data-filter="allergens">Allergens only</button>
            <button type="button" class="chip" data-filter="overlap">Overlaps only</button>
          </div>

          <div class="row">
            <div class="field">
              <label for="p1">Food 1</label>
              <select id="p1" aria-describedby="p1help"></select>
              <small id="p1help" class="muted">Pick a sample or "Custom (paste)"</small>
              <textarea id="p1txt" rows="3" placeholder="Paste ingredients separated by commas‚Ä¶"></textarea>
            </div>
            <div class="field">
              <label for="p2">Food 2</label>
              <select id="p2" aria-describedby="p2help"></select>
              <small id="p2help" class="muted">Optional</small>
              <textarea id="p2txt" rows="3" placeholder="Paste ingredients separated by commas‚Ä¶"></textarea>
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label for="p3">Food 3</label>
              <select id="p3"></select>
              <textarea id="p3txt" rows="3" placeholder="Paste ingredients separated by commas‚Ä¶"></textarea>
            </div>
            <div class="field">
              <label for="p4">Food 4</label>
              <select id="p4"></select>
              <textarea id="p4txt" rows="3" placeholder="Paste ingredients separated by commas‚Ä¶"></textarea>
            </div>
          </div>

          <div class="row" style="align-items:center">
            <div class="field">
              <label class="sr" for="safe">Preference toggles</label>
              <div class="filters">
                <label class="chip"><input type="checkbox" id="noGluten" checked> Gluten-free focus</label>
                <label class="chip"><input type="checkbox" id="noPoultry" checked> Chicken-free focus</label>
                <label class="chip"><input type="checkbox" id="hydrolysedLow"> Treat hydrolysed as low risk</label>
              </div>
            </div>
            <div class="field" style="text-align:right">
              <button type="submit" class="btn primary">Build Comparison</button>
            </div>
          </div>
        </form>
      </section>

      <aside class="card">
        <h2>How it works</h2>
        <ol>
          <li>Pick a sample product or paste its ingredient list.</li>
          <li>We normalise common ingredient names using an internal list.</li>
          <li>We flag allergens (gluten, poultry, soy, peas, fish, yeast, etc.).</li>
          <li>We build a comparison table showing overlaps and notes.</li>
        </ol>
        <p class="muted">Tip: hydrolysed proteins are treated as low risk if you toggle it on.</p>
      </aside>
    </div>

    <section class="card" id="results" aria-live="polite" style="margin-top:18px">
      <h2>Results</h2>
      <div id="resultNote" class="muted">Fill the form above and click <em>Build Comparison</em>.</div>
      <div class="filters" id="legend" hidden>
        <span class="pill danger">High: gluten/poultry</span>
        <span class="pill warn">Possible: soy/corn/peas/yeast/fish</span>
        <span class="pill ok">Safe (based on filters)</span>
      </div>
      <div style="overflow:auto">
        <table id="compareTable"></table>
      </div>
    </section>
  </main>

  <footer>
    <div class="container inner">
      <small>¬© <span id="yr"></span> allergenfreedog ‚Ä¢ For information only ‚Äî not veterinary advice.</small>
      <a href="#" id="openGlossary2" class="taglink">Open ingredient glossary</a>
    </div>
  </footer>

  <!-- Glossary Modal -->
  <div class="modal" id="glossaryModal" aria-hidden="true" role="dialog" aria-labelledby="gTitle">
    <div class="sheet">
      <div class="head">
        <h3 id="gTitle">Ingredient Glossary</h3>
        <button class="btn ghost" id="closeGlossary" aria-label="Close">Close</button>
      </div>
      <div class="body">
        <div class="field">
          <label for="gSearch">Search</label>
          <input id="gSearch" type="text" placeholder="Type to filter‚Ä¶" />
        </div>
        <div class="glossary" id="glossary"></div>
      </div>
    </div>
  </div>

  <script>
    // --- Sample catalog (can be replaced with real DB later) ---
    const CATALOG = {
      "Insect & Pea": "dehydrated insect, yellow peas, dried apple pulp, coconut oil, pea protein, linseed, calcium carbonate, dried algae (schizochytrium), pea flour, hydrolyzed yeasts, yeast extract, beta-glucans, dried sea buckthorn, fructo-oligosaccharides, mojave yucca, lactobacillus helveticus, minerals",
      "Poultry Senior Large Breed": "dehydrated poultry proteins, animal fats, maize, wheat meal, wheat flour, barley, maize gluten, wheat gluten, hydrolysed animal proteins, beet pulp, minerals, fish oil, soya oil, yeast products, psyllium husks and seeds, fructo-oligosaccharides, algal oil (schizochytrium), glucosamine, hydrolysed cartilage",
      "Salmon & Pea": "dehydrated salmon, yellow peas, hydrolysed salmon protein, buckwheat, coconut oil, apple pulp, salmon oil, hydrolysed salmon gravy, minerals, dried algae (ascophyllum), yeast extract, beta-glucans, dried sea buckthorn, fructo-oligosaccharides, mojave yucca"
    };

    // --- Normalisation & tags ---
    const MASTER = [
      {name:"wheat", tags:["gluten"], note:"Gluten cereal"},
      {name:"wheat gluten", tags:["gluten"], note:"Gluten protein"},
      {name:"barley", tags:["gluten"], note:"Gluten cereal"},
      {name:"rye", tags:["gluten"], note:"Gluten cereal"},
      {name:"maize", aliases:["corn"], tags:["possible"], note:"Some dogs sensitive"},
      {name:"soya", aliases:["soy"], tags:["possible"], note:"Legume; known allergen for some"},
      {name:"pea", aliases:["yellow peas","pea flour","pea protein"], tags:["possible"], note:"Legume protein"},
      {name:"buckwheat", tags:["possible"], note:"Plant pseudo-grain"},
      {name:"yeast", aliases:["yeast extract","hydrolyzed yeasts","yeast products"], tags:["possible"], note:"Can bother yeast‚Äësensitive dogs"},
      {name:"salmon", aliases:["salmon oil","hydrolysed salmon protein","hydrolysed salmon gravy"], tags:["possible"], note:"Fish protein/fat"},
      {name:"fish oil", tags:["possible"], note:"Fish source"},
      {name:"poultry", aliases:["dehydrated poultry proteins","poultry digest","poultry fat"], tags:["danger"], note:"Chicken/turkey family"},
      {name:"chicken", tags:["danger"], note:"Poultry"},
      {name:"animal fat", tags:["possible"], note:"May carry trace proteins depending on refinement"},
      {name:"glucosamine", tags:[], note:"Joint support"},
      {name:"hydrolysed animal proteins", tags:["low"], note:"Hydrolysed ‚Äî reduced allergenicity"},
      {name:"hydrolyzed", tags:["low"], note:"Hydrolysed marker"},
      {name:"insect", tags:[], note:"Novel protein"},
      {name:"algae", aliases:["schizochytrium","ascophyllum"], tags:[], note:"Omega‚Äë3/trace"},
      {name:"coconut oil", tags:[], note:"Fat source"},
      {name:"linseed", tags:[], note:"Omega‚Äë3 plant"},
      {name:"lactobacillus", tags:[], note:"Probiotic"},
      {name:"fructo-oligosaccharides", tags:[], note:"Prebiotic"},
      {name:"beta-glucans", tags:[], note:"Immune/prebiotic"},
      {name:"psyllium", tags:[], note:"Fibre"},
      {name:"beet pulp", tags:[], note:"Fibre"},
      {name:"apple pulp", tags:[], note:"Fibre"},
      {name:"minerals", tags:[], note:"Trace elements"},
    ];

    const HYDRO = /hydroly(s|z)ed|hydroly(s|z)sed/; // basic detector

    function stdName(raw){
      let s = raw.toLowerCase().trim();
      // remove %, parentheses content
      s = s.replace(/\(.*?\)/g, '').replace(/\d+%/g,'').replace(/\s+/g,' ').trim();
      // try alias mapping
      for(const m of MASTER){
        const terms = [m.name, ...(m.aliases||[])];
        for(const t of terms){ if(s.includes(t)) return m.name; }
      }
      return s;
    }

    function tagsFor(name){
      const m = MASTER.find(x=>x.name===name);
      return m ? m.tags : [];
    }

    function noteFor(name){
      const m = MASTER.find(x=>x.name===name);
      return m ? m.note : '';
    }

    function parseList(text){
      return text.split(/,|;|\n/).map(x=>x.trim()).filter(Boolean);
    }

    function buildOptions(sel){
      const el = document.getElementById(sel);
      const options = ["(none)", ...Object.keys(CATALOG), "Custom (paste)"];
      options.forEach(o=>{
        const op = document.createElement('option');
        op.value = o; op.textContent = o; el.append(op);
      });
      el.value = sel==='p1' ? "Insect & Pea" : "(none)";
    }

    ['p1','p2','p3','p4'].forEach(buildOptions);

    function syncTextarea(id){
      const sel = document.getElementById(id);
      const ta = document.getElementById(id+'txt');
      function update(){
        const v = sel.value;
        if(CATALOG[v]){ ta.value = CATALOG[v]; ta.disabled=false; }
        else if(v==="(none)"){ ta.value=''; ta.disabled=true; }
        else { ta.placeholder = 'Paste ingredients separated by commas‚Ä¶'; ta.disabled=false; }
      }
      sel.addEventListener('change', update); update();
    }
    ['p1','p2','p3','p4'].forEach(syncTextarea);

    // Filters
    let currentFilter = 'showAll';
    document.querySelectorAll('.chip[data-filter]').forEach(ch=>{
      ch.addEventListener('click',()=>{
        document.querySelectorAll('.chip[data-filter]').forEach(x=>x.classList.remove('active'));
        ch.classList.add('active'); currentFilter = ch.dataset.filter; applyRowFilter();
      });
    });

    function collectProducts(){
      const picks = [];
      for(const id of ['p1','p2','p3','p4']){
        const name = document.getElementById(id).value;
        const txt = document.getElementById(id+'txt').value.trim();
        if(name!=="(none)" && txt){ picks.push({label:name, list:parseList(txt)}); }
      }
      return picks;
    }

    function normaliseLists(picks){
      // Map each product to a Set of normalised ingredient names
      const norm = {};
      for(const p of picks){
        const items = new Set(p.list.map(stdName));
        norm[p.label] = items;
      }
      return norm;
    }

    function unionIngredients(norm){
      const u = new Set();
      Object.values(norm).forEach(set=>set.forEach(x=>u.add(x)));
      return Array.from(u).sort();
    }

    function allergenClass(name, prefs){
      const lowHydro = prefs.hydro && HYDRO.test(name);
      const t = tagsFor(name);
      if(prefs.noGluten && t.includes('gluten')) return 'danger';
      if(prefs.noPoultry && (name.includes('poultry') || name.includes('chicken'))) return 'danger';
      if(lowHydro) return 'ok';
      if(t.includes('danger')) return 'danger';
      if(t.includes('possible')) return 'warn';
      return 'ok';
    }

    function applyRowFilter(){
      const rows = document.querySelectorAll('#compareTable tbody tr');
      rows.forEach(r=>{
        if(currentFilter==='showAll'){ r.hidden=false; return; }
        const isAllergen = r.dataset.risk!=='ok';
        const overlap = Number(r.dataset.count||0) >= 2;
        r.hidden = (currentFilter==='allergens' && !isAllergen) || (currentFilter==='overlap' && !overlap);
      });
    }

    document.getElementById('compare').addEventListener('submit', (e)=>{
      e.preventDefault();
      const prefs = {
        noGluten: document.getElementById('noGluten').checked,
        noPoultry: document.getElementById('noPoultry').checked,
        hydro: document.getElementById('hydrolysedLow').checked
      };

      const picks = collectProducts();
      if(!picks.length){ alert('Please select or paste at least one product.'); return; }
      const norm = normaliseLists(picks);
      const union = unionIngredients(norm);

      // Build table
      const tbl = document.getElementById('compareTable');
      const cols = ['Ingredient', ...picks.map(p=>p.label), 'Allergen note'];
      tbl.innerHTML = '<thead><tr>' + cols.map(c=>`<th>${c}</th>`).join('') + '</tr></thead><tbody></tbody>';
      const body = tbl.querySelector('tbody');

      union.forEach(name=>{
        // presence per product
        let count = 0; const cells = picks.map(p=>{
          const hit = norm[p.label].has(name);
          if(hit) count++; 
          return `<td>${hit ? '‚úÖ' : ''}</td>`;
        });
        // allergen note & class
        const risk = allergenClass(name, prefs);
        const cls = risk==='danger' ? 'pill danger' : risk==='warn' ? 'pill warn' : 'pill ok';
        const note = [noteFor(name) || ''].filter(Boolean).join(' ');
        const row = document.createElement('tr');
        row.className = 'hover';
        row.dataset.count = count;
        row.dataset.risk = risk;
        row.innerHTML = `<td><strong>${name}</strong></td>${cells.join('')}<td><span class="${cls}">${risk.toUpperCase()}</span> ${note}</td>`;
        body.append(row);
      });

      document.getElementById('legend').hidden = false;
      document.getElementById('resultNote').textContent = `${union.length} unique ingredients normalised. Click column headers to sort (browser shortcuts).`;
      applyRowFilter();
    });

    // --- Glossary Modal ---
    const modal = document.getElementById('glossaryModal');
    const openBtns = [document.getElementById('openGlossary'), document.getElementById('openGlossary2')];
    const closeBtn = document.getElementById('closeGlossary');
    openBtns.forEach(b=>b.addEventListener('click', ()=>{ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); document.getElementById('gSearch').focus(); }));
    closeBtn.addEventListener('click', ()=>{ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); });
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeBtn.click(); });

    // Populate glossary
    const gloss = document.getElementById('glossary');
    function renderGlossary(filter=''){
      gloss.innerHTML = '';
      MASTER.filter(m=>m.name.includes(filter.toLowerCase())).forEach(m=>{
        const card = document.createElement('div');
        card.className='gloss';
        const tag = m.tags.includes('gluten')? 'danger' : m.tags.includes('danger')? 'danger' : m.tags.includes('possible')? 'warn':'ok';
        card.innerHTML = `<h4>${m.name}</h4><p class="muted">${m.note||''}</p><span class="pill ${tag}">${tag.toUpperCase()}</span>`;
        gloss.append(card);
      });
    }
    renderGlossary();
    document.getElementById('gSearch').addEventListener('input', (e)=>renderGlossary(e.target.value));

    // year
    document.getElementById('yr').textContent = new Date().getFullYear();
  </script>
</body>
</html>
